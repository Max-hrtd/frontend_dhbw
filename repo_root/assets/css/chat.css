:root {
    /* Light */
    --bg: #ffffff;
    --fg: #0b0f14;
    --muted: #5b6470;
    --panel: #f6f7f9;
    --border: #e6e8ec;
  
    --bubble-user: #e8f5e9;
    --bubble-user-fg: #000000;
    --bubble-bot: #ffffff;
    --bubble-bot-border: #e6e8ec;
  
    --btn-bg: #0b0f14;
    --btn-fg: #ffffff;
  
    --radius: 14px;
    --shadow: 0 2px 10px rgba(0,0,0,.06);
  
    --font: system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
    --size-1: clamp(14px, 0.85vw + 12px, 15px);
  
    /* Einheitliche Höhe für Input & Sendebutton */
    --composer-field-h: 48px;
  }
  
  html[data-theme="dark"] {
    --bg: #000000;
    --fg: #e9edf2;
    --muted: #a4adba;
    --panel: #12171e;
    --border: #1c2330;
  
    --bubble-user: #e9edf2;
    --bubble-user-fg: #0b0f14;
    --bubble-bot: #0f141a;
    --bubble-bot-border: #1c2330;
  
    --btn-bg: #e9edf2;
    --btn-fg: #0b0f14;
  
    --shadow: 0 2px 16px rgba(0,0,0,.25);
  }
  
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: var(--font);
    font-size: var(--size-1);
    line-height: 1.5;
    background: var(--bg);
    color: var(--fg);
    display: flex;
    flex-direction: column;
  }
  
  /* Header */
  .topbar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 12px; border-bottom: 1px solid var(--border);
    background: var(--bg); position: sticky; top: 0; z-index: 5;
  }
  .left { display: flex; align-items: center; gap: 10px; }
  .link { color: inherit; text-decoration: none; opacity: .9; }
  .link:hover { opacity: 1; text-decoration: underline; }
  .badge { font-size: 12px; color: var(--muted); padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; }
  
  .btn, .btn-ghost {
    appearance: none; border-radius: var(--radius); cursor: pointer;
    padding: 10px 14px; font-size: 14px; font-weight: 600;
    border: 1px solid var(--border);
  }
  .btn { background: var(--btn-bg); color: var(--btn-fg); border-color: transparent; }
  .btn:hover { opacity: .92; }
  .btn-ghost { background: transparent; color: inherit; }
  .btn-ghost:hover { opacity: .8; }
  
  .sr { position: absolute; clip: rect(0 0 0 0); clip-path: inset(50%); width: 1px; height: 1px; overflow: hidden; white-space: nowrap; }
  
  /* Layout */
  .chat { max-width: 820px; width: 100%; margin: 0 auto; padding: 16px; display: grid; grid-template-rows: 1fr auto; gap: 12px; height: calc(100vh - 56px); }
  .messages { overflow-y: auto; display: grid; gap: 10px; align-content: start; padding-bottom: 8px; padding-inline: 2px; }
  
  /* Messages */
  .messages .msg { width: 100%; }
  .msg { position: relative; display: flex; align-items: center; gap: 10px; }
  .msg.user { justify-content: flex-end; }
  .msg.bot  { justify-content: flex-start; }
  
  .stack { position: relative; display: grid; gap: 4px; max-width: min(78%, 720px); min-width: 0; }
  .msg.user .stack { margin-left: auto; }
  .msg.bot  .stack { margin-right: auto; }
  
  .avatar {
    width: 32px; height: 32px; border-radius: 50%;
    border: 1px solid var(--border);
    display: grid; place-items: center;
    flex: 0 0 32px;
    box-shadow: var(--shadow);
  }
  .avatar--bot  { background: #eef2ff; }
  .avatar--user { background: #e8f5e9; }
  html[data-theme="dark"] .avatar--bot { background: #0f172a; }
  html[data-theme="dark"] .avatar--user { background: #e9edf2; }
  .avatar__icon { font-size: 16px; line-height: 1; }
  
  .bubble {
    display: inline-block;
    max-width: 100%;
    padding: 10px 12px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    line-height: 1.45;
    white-space: pre-wrap;
    word-break: normal;
    overflow-wrap: break-word;
    hyphens: auto;
  }
  .user .bubble { background: var(--bubble-user); color: var(--bubble-user-fg); }
  .bot  .bubble { background: var(--bubble-bot); border: 1px solid var(--bubble-bot-border); }
  
  /* Meta (Zeitstempel) */
  .meta { color: var(--muted); font-size: 12px; user-select: none; }
  .user .meta { text-align: right; }
  
  /* Tools – Copy-Icon immer sichtbar, unten rechts an der Bubble */
  /* Copy-Tools: an der Bubble-Ecke fix positionieren */
.msg-tools{
    position: absolute;
    bottom: -6px;      /* ein Stück unter die Bubble */
    opacity: 1;
    pointer-events: auto;
  }
  
  .msg-tools.right{    /* Bot: rechts */
    right: 0px;
    left: auto;
  }
  
  .msg-tools.left{     /* User: links */
    left: 0px;
    right: auto;
  }


  .tool {
    appearance: none;
    border: 1px solid var(--border);
    background: var(--panel);
    padding: 4px 6px;
    border-radius: 8px;
    cursor: pointer;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: var(--fg); /* Light-Mode Farbe */
  }
  .tool:hover { background: var(--bg); }
  
  /* Copy-Icon (SVG) */
  .icon-copy {
    width: 16px;
    height: 16px;
    display: block;
  }
  /* Shapes im SVG erhalten die Farbe */
  .icon-copy rect,
  .icon-copy path,
  .tool svg *,
  .tool svg {
    stroke: currentColor;
    fill: none;
  }
  
  /* Dark Mode: Copy-Icon weiß */
  html[data-theme="dark"] .tool { color: #ffffff; }
  
  /* "Kopiert!" rechts neben dem Icon */
  .tool.copied::after{
    content:"✓ Kopiert";
    margin-left: 6px;
    color: var(--muted);
    font-size: 12px;
  }
  
  /* Gruppierung aufeinanderfolgender Bubbles */
  .msg + .msg.user .bubble { border-top-right-radius: 8px; }
  .msg + .msg.bot  .bubble { border-top-left-radius: 8px; }
  .messages .msg.user + .msg.user .bubble { margin-top: -6px; }
  .messages .msg.bot  + .msg.bot  .bubble { margin-top: -6px; }
  
  /* =========================
     Composer (Eingabezeile)
     ========================= */
  .composer {
    position: sticky;
    bottom: 0;
    background: var(--bg);
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    border-top: 1px solid var(--border);
    padding: 8px 12px;
    align-items: start;
  }
  
  /* Input-Wrapper + Hinweise */
  .input-wrap {
    position: relative;
    display: grid;
    gap: 6px;
    min-width: 0;
  }

  /* neuer Wrapper nur fürs Feld */
.input-field {
    position: relative;
    width: 100%;
  }
  

  /* Büroklammer */
.upload-icon {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 18px;
    opacity: 0.7;
    line-height: 1;  
  }

  .upload-icon:hover {
    opacity: 1;
  }

  /* sorgt dafür, dass Textarea rechts innen genug Platz hat */
.input {
    padding-right: 50px; /* Platz für Büroklammer */
  }

  .hints { color: var(--muted); font-size: 12px; user-select: none; }
  
  /* Eingabefeld */
  .input {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    background: var(--panel);
    color: var(--fg);
    resize: none;
    line-height: 1.5;
    width: 100%;
    min-height: var(--composer-field-h);
    box-sizing: border-box;
  }
  .input::placeholder { color: var(--muted); }
  
  /* Runder Senden-Button */
  .send-circle {
    align-self: start;
    --size: var(--composer-field-h);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--composer-field-h);
    height: var(--composer-field-h);
    border-radius: 50%;
    border: none;
    background: var(--btn-bg);
    color: var(--btn-fg);
    box-shadow: var(--shadow);
    cursor: pointer;
  }
  .send-circle:hover { opacity: .92; }
  .send-ic { width: 22px; height: 22px; display: block; }
  
  /* Typing Indicator */
  .msg.typing .bubble { display: inline-flex; gap: 6px; align-items: center; }
  .typing-dots { display: inline-flex; gap: 4px; }
  .typing-dots span {
    width: 6px; height: 6px; border-radius: 50%;
    background: currentColor; opacity: .35; display: inline-block;
    animation: pulse 1.2s infinite ease-in-out;
  }
  .typing-dots span:nth-child(2) { animation-delay: .15s; }
  .typing-dots span:nth-child(3) { animation-delay: .3s; }
  @keyframes pulse { 0%,80%,100%{opacity:.35;transform:translateY(0)} 40%{opacity:1;transform:translateY(-2px)} }
  
  /* Scroll to bottom Button */
  .scroll-btn {
    position: absolute;
    right: 20px; bottom: 80px;
    padding: 6px 10px;
    font-size: 18px;
    border-radius: 50%;
    border: 1px solid var(--border);
    background: var(--panel);
    box-shadow: var(--shadow);
    cursor: pointer;
    opacity: 0; pointer-events: none;
    transition: opacity .2s ease;
  }
  .scroll-btn.show { opacity: 1; pointer-events: auto; }
  
  /* Scrollbar dezent */
  .messages::-webkit-scrollbar { width: 10px; }
  .messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
  .messages { scrollbar-color: var(--border) transparent; scrollbar-width: thin; }
  
  /* Focus & Transitions */
  :where(button, a, input, textarea):focus-visible { outline: 2px solid #60a5fa; outline-offset: 2px; }
  :root, html[data-theme="dark"] { transition: background-color .25s ease, color .25s ease, border-color .25s ease; }
  @media (prefers-reduced-motion: reduce) { :root, html[data-theme="dark"] { transition: none !important; } }
  
  /* Safe-area auf iOS */
  @supports (padding: max(0px)) {
    .chat { padding-bottom: max(16px, env(safe-area-inset-bottom)); }
    .topbar { padding-top: max(8px, env(safe-area-inset-top)); }
  }
  
  .bubble-wrap {
    display: flex;
    align-items: center; /* Avatar vertikal mittig zur Bubble */
    gap: 10px;
  }
  
  .msg.user .bubble-wrap {
    justify-content: flex-end;
  }
  
  .msg.bot .bubble-wrap {
    justify-content: flex-start;
  }
  
  .bubble pre, .bubble code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background: color-mix(in oklab, var(--panel) 92%, var(--fg) 8%);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: .6em .8em;
    overflow: auto;
    display: block;
    white-space: pre;
    max-width: 100%;
  }
  

  /* === Attachment-Pill (Vorschau im Textfeld) === */
.input-field { position: relative; width: 100%; }

/* Wenn eine Datei gewählt ist, geben wir dem Textfeld unten extra Platz */
.input-field.has-attachment .input { padding-bottom: 56px; }

/* Die „Pill“ sitzt innen im Textfeld, unten links */
.attach-pill {
  position: absolute;
  left: 10px;
  bottom: 10px;
  max-width: calc(100% - 20px);
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 999px;
  background: var(--panel);
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  font-size: 13px;
  color: var(--fg);
  pointer-events: auto;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Name im Chip wird notfalls gekürzt */
.attach-name {
  display: inline-block;
  max-width: 220px;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Entfernen-Button (x) */
.attach-remove {
  appearance: none;
  border: 1px solid var(--border);
  background: transparent;
  color: inherit;
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 10px;
  cursor: pointer;
}
.attach-remove:hover { background: var(--panel); }


